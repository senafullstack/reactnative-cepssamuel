{"ast":null,"code":"\"use strict\";var _classCallCheck=require(\"@babel/runtime/helpers/classCallCheck\");var _createClass=require(\"@babel/runtime/helpers/createClass\");var _assertThisInitialized=require(\"@babel/runtime/helpers/assertThisInitialized\");var _get=require(\"@babel/runtime/helpers/get\");var _inherits=require(\"@babel/runtime/helpers/inherits\");var _possibleConstructorReturn=require(\"@babel/runtime/helpers/possibleConstructorReturn\");var _getPrototypeOf=require(\"@babel/runtime/helpers/getPrototypeOf\");function _createForOfIteratorHelperLoose(o,allowArrayLike){var it=typeof Symbol!==\"undefined\"&&o[Symbol.iterator]||o[\"@@iterator\"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;return function(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=void 0;var _domhandler=require(\"domhandler\");var _domUtils=require(\"./dom-utils\");function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var DomHandler=function(_domhandler$DomHandle){_inherits(DomHandler,_domhandler$DomHandle);var _super=_createSuper(DomHandler);function DomHandler(options){var _this;_classCallCheck(this,DomHandler);_this=_super.call(this,undefined,options,undefined);_defineProperty(_assertThisInitialized(_this),\"ignoredTags\",void 0);_defineProperty(_assertThisInitialized(_this),\"ignoredTagsCount\",-1);_defineProperty(_assertThisInitialized(_this),\"visitors\",void 0);var ignoredTags={};for(var _iterator=_createForOfIteratorHelperLoose(options.ignoredTags||[]),_step;!(_step=_iterator()).done;){var tag=_step.value;ignoredTags[tag]=true;}_this.ignoredTags=ignoredTags;_this.visitors=options.visitors||{};var isIgnored=_this.isIgnored.bind(_assertThisInitialized(_this));if(options.ignoreNode){_this.isIgnored=function(node){return isIgnored(node)||options.ignoreNode(node,_this.tagStack[_this.tagStack.length-1]);};}return _this;}_createClass(DomHandler,[{key:\"isIgnored\",value:function isIgnored(node){return this.ignoredTags[node.name]||this.ignoredTagsCount>-1;}},{key:\"addNode\",value:function addNode(node){if(this.isIgnored(node)===true){if((0,_domUtils.isDomElement)(node)){this.ignoredTagsCount++;}}else{_get(_getPrototypeOf(DomHandler.prototype),\"addNode\",this).call(this,node);if((0,_domUtils.isDomText)(node)){var _this$visitors$onText,_this$visitors;(_this$visitors$onText=(_this$visitors=this.visitors).onText)===null||_this$visitors$onText===void 0?void 0:_this$visitors$onText.call(_this$visitors,node);}}}},{key:\"ontext\",value:function ontext(text){if(this.ignoredTagsCount<0){_get(_getPrototypeOf(DomHandler.prototype),\"ontext\",this).call(this,text);}}},{key:\"onopentag\",value:function onopentag(name,attribs){_get(_getPrototypeOf(DomHandler.prototype),\"onopentag\",this).call(this,name,attribs);}},{key:\"onclosetag\",value:function onclosetag(){var _this$visitors$onElem,_this$visitors2;(_this$visitors$onElem=(_this$visitors2=this.visitors).onElement)===null||_this$visitors$onElem===void 0?void 0:_this$visitors$onElem.call(_this$visitors2,this.tagStack[this.tagStack.length-1]);_get(_getPrototypeOf(DomHandler.prototype),\"onclosetag\",this).call(this);if(this.ignoredTagsCount>-1){this.ignoredTagsCount--;}}},{key:\"onend\",value:function onend(){var _this$visitors$onDocu,_this$visitors3;(_this$visitors$onDocu=(_this$visitors3=this.visitors).onDocument)===null||_this$visitors$onDocu===void 0?void 0:_this$visitors$onDocu.call(_this$visitors3,this.root);}}]);return DomHandler;}(_domhandler.DomHandler);exports.default=DomHandler;","map":{"version":3,"sources":["DomHandler.ts"],"names":["OriginalDomHandler","constructor","ignoredTags","options","isIgnored","node","addNode","ontext","onopentag","onclosetag","onend"],"mappings":"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","sourcesContent":["import {\n  DomHandler as OriginalDomHandler,\n  DomHandlerOptions as OriginalDomHandlerOptions,\n  Document,\n  Element,\n  Node,\n  Text,\n  NodeWithChildren\n} from 'domhandler';\nimport { isDomElement, isDomText } from './dom-utils';\n\n/**\n * A record of callback to visit the DOM.\n *\n * @public\n */\nexport interface DomVisitorCallbacks {\n  /**\n   * A callback invoked when encountering a {@link Document}.\n   *\n   * @param document - The document to visit.\n   *\n   */\n  onDocument?(document: Document): void;\n  /**\n   * A callback invoked when encountering an {@link Element}.\n   *\n   * @param element - The element to visit.\n   */\n  onElement?(element: Element): void;\n  /**\n   * A callback invoked when encountering a {@link Text} node.\n   *\n   * @param text - The text to visit.\n   */\n  onText?(text: Text): void;\n}\n\nexport interface DomHandlerOptions extends OriginalDomHandlerOptions {\n  ignoredTags?: string[];\n  visitors?: DomVisitorCallbacks;\n  ignoreNode?: (\n    node: Node,\n    parent: NodeWithChildren\n  ) => boolean | void | unknown;\n}\n\nexport default class DomHandler extends OriginalDomHandler {\n  private ignoredTags: Record<string, boolean>;\n  private ignoredTagsCount = -1;\n  private visitors: DomVisitorCallbacks;\n\n  constructor(options: DomHandlerOptions) {\n    super(undefined, options, undefined);\n    let ignoredTags: DomHandler['ignoredTags'] = {};\n    for (const tag of options.ignoredTags || []) {\n      ignoredTags[tag] = true;\n    }\n    this.ignoredTags = ignoredTags;\n    this.visitors = options.visitors || {};\n    const isIgnored = this.isIgnored.bind(this);\n    if (options.ignoreNode) {\n      this.isIgnored = (node) => {\n        return (\n          isIgnored(node) ||\n          options.ignoreNode!(node, this.tagStack[this.tagStack.length - 1])\n        );\n      };\n    }\n  }\n\n  isIgnored(node: Node): boolean | unknown | void {\n    return (\n      (this.ignoredTags[(node as Element).name] as boolean) ||\n      this.ignoredTagsCount > -1\n    );\n  }\n\n  addNode(node: Node): void {\n    if (this.isIgnored(node) === true) {\n      // increment only for elements.\n      if (isDomElement(node)) {\n        this.ignoredTagsCount++;\n      }\n    } else {\n      super.addNode(node);\n      if (isDomText(node)) {\n        this.visitors.onText?.(node);\n      }\n    }\n  }\n\n  ontext(text: string) {\n    // Only include text when out of an\n    // ignoring session.\n    if (this.ignoredTagsCount < 0) {\n      super.ontext(text);\n    }\n  }\n\n  onopentag(name: string, attribs: any): void {\n    super.onopentag(name, attribs);\n  }\n\n  onclosetag() {\n    // Call onElement on close to give access to this node children\n    this.visitors.onElement?.(\n      this.tagStack[this.tagStack.length - 1] as Element\n    );\n    super.onclosetag();\n    if (this.ignoredTagsCount > -1) {\n      this.ignoredTagsCount--;\n    }\n  }\n\n  onend(): void {\n    this.visitors.onDocument?.(this.root);\n  }\n}\n"]},"metadata":{},"sourceType":"script"}