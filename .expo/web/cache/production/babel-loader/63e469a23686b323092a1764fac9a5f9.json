{"ast":null,"code":"\"use strict\";var _slicedToArray=require(\"@babel/runtime/helpers/slicedToArray\");var _regeneratorRuntime=require(\"@babel/runtime/regenerator\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=SourceLoaderUri;var _react=_interopRequireWildcard(require(\"react\"));var _RenderTTree=_interopRequireDefault(require(\"./RenderTTree\"));var _sourceLoaderContext=_interopRequireDefault(require(\"./context/sourceLoaderContext\"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!==\"function\")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!==\"object\"&&typeof obj!==\"function\"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!==\"default\"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}var ERROR_STATE={error:true,resolvedHTML:null};function loadHTMLResource(uri,_ref){var body,headers,method,response,html;return _regeneratorRuntime.async(function loadHTMLResource$(_context){while(1){switch(_context.prev=_context.next){case 0:body=_ref.body,headers=_ref.headers,method=_ref.method;_context.next=3;return _regeneratorRuntime.awrap(fetch(uri,{body:body,headers:headers,method:method}));case 3:response=_context.sent;if(!response.ok){_context.next=9;break;}_context.next=7;return _regeneratorRuntime.awrap(response.text());case 7:html=_context.sent;return _context.abrupt(\"return\",{resolvedHTML:html,error:false});case 9:return _context.abrupt(\"return\",ERROR_STATE);case 10:case\"end\":return _context.stop();}}},null,null,null,Promise);}function useUriSourceLoader(_ref2){var source=_ref2.source,onHTMLLoaded=_ref2.onHTMLLoaded;var _ref3=(0,_react.useState)({error:false,resolvedHTML:null}),_ref4=_slicedToArray(_ref3,2),loadState=_ref4[0],setState=_ref4[1];var error=loadState.error;(0,_react.useEffect)(function(){var cancelled=false;if(!error){setState({error:false,resolvedHTML:null});loadHTMLResource(source.uri,{body:source.body,headers:source.headers,method:source.method}).then(function(state){!cancelled&&setState(state);}).catch(function(){!cancelled&&setState(ERROR_STATE);});}return function(){cancelled=true;};},[error,source.uri,source.body,source.headers,source.method]);(0,_react.useEffect)(function(){loadState.resolvedHTML&&(onHTMLLoaded===null||onHTMLLoaded===void 0?void 0:onHTMLLoaded.call(null,loadState.resolvedHTML));},[loadState.resolvedHTML,onHTMLLoaded]);return loadState;}function SourceLoaderUri(props){var _ref5=(0,_react.useContext)(_sourceLoaderContext.default),remoteErrorView=_ref5.remoteErrorView,remoteLoadingView=_ref5.remoteLoadingView;var _useUriSourceLoader=useUriSourceLoader(props),resolvedHTML=_useUriSourceLoader.resolvedHTML,error=_useUriSourceLoader.error;if(error){return remoteErrorView.call(null,props.source);}if(resolvedHTML===null){return remoteLoadingView.call(null,props.source);}return _react.default.createElement(_RenderTTree.default,{document:resolvedHTML,baseUrl:props.source.uri});}","map":{"version":3,"sources":["SourceLoaderUri.tsx"],"names":["ERROR_STATE","error","resolvedHTML","method","response","fetch","body","headers","html","onHTMLLoaded","cancelled","setState","loadHTMLResource","source","state","loadState","remoteLoadingView","sourceLoaderContext","useUriSourceLoader","remoteErrorView","props","RenderTTree","document","baseUrl","uri"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\nimport { HTMLSourceUri } from './shared-types';\nimport { SourceLoaderProps } from './internal-types';\nimport RenderTTree from './RenderTTree';\nimport sourceLoaderContext from './context/sourceLoaderContext';\n\ninterface LoaderInternalState {\n  error: boolean;\n  resolvedHTML: string | null;\n}\n\nconst ERROR_STATE = {\n  error: true,\n  resolvedHTML: null\n};\n\nasync function loadHTMLResource(\n  uri: string,\n  { body, headers, method }: Omit<HTMLSourceUri, 'uri'>\n): Promise<LoaderInternalState> {\n  const response = await fetch(uri, {\n    body,\n    headers,\n    method\n  });\n  if (response.ok) {\n    const html = await response.text();\n    return {\n      resolvedHTML: html,\n      error: false\n    };\n  }\n  return ERROR_STATE;\n}\n\nexport type UriSourceLoaderProps = {\n  source: HTMLSourceUri;\n} & SourceLoaderProps;\n\nfunction useUriSourceLoader({ source, onHTMLLoaded }: UriSourceLoaderProps) {\n  const [loadState, setState] = useState<LoaderInternalState>({\n    error: false,\n    resolvedHTML: null\n  });\n  const { error } = loadState;\n\n  // Effect to reload on uri changes\n  useEffect(() => {\n    let cancelled = false;\n    if (!error) {\n      setState({ error: false, resolvedHTML: null });\n      loadHTMLResource(source.uri, {\n        body: source.body,\n        headers: source.headers,\n        method: source.method\n      })\n        .then((state) => {\n          !cancelled && setState(state);\n        })\n        .catch(() => {\n          !cancelled && setState(ERROR_STATE);\n        });\n    }\n    return () => {\n      cancelled = true;\n    };\n  }, [error, source.uri, source.body, source.headers, source.method]);\n  useEffect(() => {\n    loadState.resolvedHTML && onHTMLLoaded?.call(null, loadState.resolvedHTML);\n  }, [loadState.resolvedHTML, onHTMLLoaded]);\n  return loadState;\n}\n\nexport default function SourceLoaderUri(props: UriSourceLoaderProps) {\n  const { remoteErrorView, remoteLoadingView } =\n    useContext(sourceLoaderContext);\n  const { resolvedHTML, error } = useUriSourceLoader(props);\n  if (error) {\n    return remoteErrorView.call(null, props.source);\n  }\n  if (resolvedHTML === null) {\n    return remoteLoadingView.call(null, props.source);\n  }\n  return React.createElement(RenderTTree, {\n    document: resolvedHTML!,\n    baseUrl: props.source.uri\n  });\n}\n"]},"metadata":{},"sourceType":"script"}