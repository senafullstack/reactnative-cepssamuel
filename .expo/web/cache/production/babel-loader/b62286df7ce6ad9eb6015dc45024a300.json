{"ast":null,"code":"\"use strict\";var _toConsumableArray=require(\"@babel/runtime/helpers/toConsumableArray\");var _classCallCheck=require(\"@babel/runtime/helpers/classCallCheck\");var _createClass=require(\"@babel/runtime/helpers/createClass\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.TStylesMerger=exports.emptyProcessedPropsReg=void 0;var _cssProcessor=_interopRequireWildcard(require(\"@native-html/css-processor\"));var _TStyles=require(\"./TStyles\");function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!==\"function\")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!==\"object\"&&typeof obj!==\"function\"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!==\"default\"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var emptyProcessedPropsReg=new _cssProcessor.CSSProcessedProps();exports.emptyProcessedPropsReg=emptyProcessedPropsReg;function mapMixedStyleRecordToCSSProcessedPropsReg(processor,styles){var regStyles={};for(var key in styles){regStyles[key]=processor.compileStyleDeclaration(styles[key]);}return regStyles;}var TStylesMerger=function(){function TStylesMerger(config,modelRegistry,cssProcessorConfig){_classCallCheck(this,TStylesMerger);_defineProperty(this,\"processor\",void 0);_defineProperty(this,\"tagsStyles\",void 0);_defineProperty(this,\"classesStyles\",void 0);_defineProperty(this,\"idsStyles\",void 0);_defineProperty(this,\"enableCSSInlineProcessing\",void 0);_defineProperty(this,\"enableUserAgentStyles\",void 0);_defineProperty(this,\"modelRegistry\",void 0);this.processor=new _cssProcessor.default(cssProcessorConfig);this.modelRegistry=modelRegistry;this.classesStyles=mapMixedStyleRecordToCSSProcessedPropsReg(this.processor,config.classesStyles);this.tagsStyles=mapMixedStyleRecordToCSSProcessedPropsReg(this.processor,config.tagsStyles);this.idsStyles=mapMixedStyleRecordToCSSProcessedPropsReg(this.processor,config.idsStyles);this.enableCSSInlineProcessing=config.enableCSSInlineProcessing;this.enableUserAgentStyles=config.enableUserAgentStyles;}_createClass(TStylesMerger,[{key:\"compileInlineCSS\",value:function compileInlineCSS(inlineCSS){return this.processor.compileInlineCSS(inlineCSS);}},{key:\"compileStyleDeclaration\",value:function compileStyleDeclaration(styleDeclaration){return this.processor.compileStyleDeclaration(styleDeclaration);}},{key:\"buildStyles\",value:function buildStyles(inlineStyle,parentStyles,descriptor){var _this=this;var _this$tagsStyles,_this$idsStyles,_ref,_ref2,_model$getMixedUAStyl,_model$getUADerivedSt,_model$mixedUAStyles;var ownInlinePropsReg=this.enableCSSInlineProcessing&&inlineStyle?this.compileInlineCSS(inlineStyle):null;var model=descriptor.tagName?this.modelRegistry.getElementModelFromTagName(descriptor.tagName):null;var userTagOwnProps=(_this$tagsStyles=this.tagsStyles[descriptor.tagName])!==null&&_this$tagsStyles!==void 0?_this$tagsStyles:null;var userIdOwnProps=(_this$idsStyles=this.idsStyles[descriptor.id])!==null&&_this$idsStyles!==void 0?_this$idsStyles:null;var classes=descriptor.classes;var userClassesOwnPropsList=classes.map(function(c){return _this.classesStyles[c]||null;});var dynamicPropsFromAttributes=this.enableUserAgentStyles?(_ref=(_ref2=(model===null||model===void 0?void 0:(_model$getMixedUAStyl=model.getMixedUAStyles)===null||_model$getMixedUAStyl===void 0?void 0:_model$getMixedUAStyl.call(model,descriptor,descriptor.domNode))||null)!==null&&_ref2!==void 0?_ref2:model===null||model===void 0?void 0:(_model$getUADerivedSt=model.getUADerivedStyleFromAttributes)===null||_model$getUADerivedSt===void 0?void 0:_model$getUADerivedSt.call(model,descriptor.attributes,descriptor.markers))!==null&&_ref!==void 0?_ref:null:null;var userAgentTagProps=this.enableUserAgentStyles?(_model$mixedUAStyles=model===null||model===void 0?void 0:model.mixedUAStyles)!==null&&_model$mixedUAStyles!==void 0?_model$mixedUAStyles:null:null;var mergedOwnProps=emptyProcessedPropsReg.merge.apply(emptyProcessedPropsReg,[userAgentTagProps&&this.processor.compileStyleDeclaration(userAgentTagProps),dynamicPropsFromAttributes&&this.processor.compileStyleDeclaration(dynamicPropsFromAttributes),userTagOwnProps].concat(_toConsumableArray(userClassesOwnPropsList),[userIdOwnProps,ownInlinePropsReg]));return new _TStyles.TStyles(mergedOwnProps,parentStyles);}}]);return TStylesMerger;}();exports.TStylesMerger=TStylesMerger;","map":{"version":3,"sources":["TStylesMerger.ts"],"names":["emptyProcessedPropsReg","CSSProcessedProps","regStyles","processor","styles","constructor","CSSProcessor","mapMixedStyleRecordToCSSProcessedPropsReg","config","compileInlineCSS","compileStyleDeclaration","buildStyles","ownInlinePropsReg","model","descriptor","userTagOwnProps","userIdOwnProps","classes","userClassesOwnPropsList","c","dynamicPropsFromAttributes","userAgentTagProps","mergedOwnProps","TStyles"],"mappings":"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","sourcesContent":["import CSSProcessor, {\n  CSSProcessedProps,\n  CSSProcessorConfig,\n  MixedStyleDeclaration\n} from '@native-html/css-processor';\nimport HTMLModelRegistry from '../model/HTMLModelRegistry';\nimport { TNodeDescriptor } from '../tree/tree-types';\nimport { TStyles } from './TStyles';\nimport { StylesConfig } from './types';\n\nexport const emptyProcessedPropsReg: CSSProcessedProps =\n  new CSSProcessedProps();\n\nfunction mapMixedStyleRecordToCSSProcessedPropsReg(\n  processor: CSSProcessor,\n  styles?: Record<string, MixedStyleDeclaration>\n): Record<string, CSSProcessedProps> {\n  let regStyles: Record<string, CSSProcessedProps> = {};\n  for (const key in styles) {\n    regStyles[key] = processor.compileStyleDeclaration(styles[key]);\n  }\n  return regStyles;\n}\n\n// Specificity hierarchy, in descending order:\n// 1. Inline styles\n// 2. ID (idsStyles)\n// 3. Classes (classesStyles)\n// 4. Element name (tagsStyles)\n// 5. Attribute styles (styles derived from attributes)\n// 6. Default element styles\n// 7. Inherited styles (baseFontStyles)\nexport class TStylesMerger {\n  private processor: CSSProcessor;\n  private tagsStyles: Record<string, CSSProcessedProps>;\n  private classesStyles: Record<string, CSSProcessedProps>;\n  private idsStyles: Record<string, CSSProcessedProps>;\n  private enableCSSInlineProcessing: boolean;\n  private enableUserAgentStyles: boolean;\n  private modelRegistry: HTMLModelRegistry<string>;\n  constructor(\n    config: Required<StylesConfig>,\n    modelRegistry: HTMLModelRegistry<string>,\n    cssProcessorConfig?: CSSProcessorConfig\n  ) {\n    this.processor = new CSSProcessor(cssProcessorConfig);\n    this.modelRegistry = modelRegistry;\n    this.classesStyles = mapMixedStyleRecordToCSSProcessedPropsReg(\n      this.processor,\n      config.classesStyles\n    );\n    this.tagsStyles = mapMixedStyleRecordToCSSProcessedPropsReg(\n      this.processor,\n      config.tagsStyles\n    );\n    this.idsStyles = mapMixedStyleRecordToCSSProcessedPropsReg(\n      this.processor,\n      config.idsStyles\n    );\n    this.enableCSSInlineProcessing = config.enableCSSInlineProcessing;\n    this.enableUserAgentStyles = config.enableUserAgentStyles;\n  }\n\n  compileInlineCSS(inlineCSS: string) {\n    return this.processor.compileInlineCSS(inlineCSS);\n  }\n\n  compileStyleDeclaration(styleDeclaration: MixedStyleDeclaration) {\n    return this.processor.compileStyleDeclaration(styleDeclaration);\n  }\n\n  buildStyles(\n    inlineStyle: string,\n    parentStyles: TStyles | null,\n    descriptor: TNodeDescriptor\n  ): TStyles {\n    const ownInlinePropsReg =\n      this.enableCSSInlineProcessing && inlineStyle\n        ? this.compileInlineCSS(inlineStyle)\n        : null;\n    const model = descriptor.tagName\n      ? this.modelRegistry.getElementModelFromTagName(descriptor.tagName)\n      : null;\n    const userTagOwnProps =\n      this.tagsStyles[descriptor.tagName as string] ?? null;\n    const userIdOwnProps = this.idsStyles[descriptor.id as string] ?? null;\n    const classes = descriptor.classes;\n    const userClassesOwnPropsList = classes.map(\n      (c) => this.classesStyles[c] || null\n    );\n    const dynamicPropsFromAttributes = this.enableUserAgentStyles\n      ? (model?.getMixedUAStyles?.(descriptor, descriptor.domNode!) || null) ??\n        model?.getUADerivedStyleFromAttributes?.(\n          descriptor.attributes,\n          descriptor.markers\n        ) ??\n        null\n      : null;\n    const userAgentTagProps = this.enableUserAgentStyles\n      ? model?.mixedUAStyles ?? null\n      : null;\n    // Latest properties will override former properties.\n    const mergedOwnProps = emptyProcessedPropsReg.merge(\n      userAgentTagProps &&\n        this.processor.compileStyleDeclaration(userAgentTagProps),\n      dynamicPropsFromAttributes &&\n        this.processor.compileStyleDeclaration(dynamicPropsFromAttributes),\n      userTagOwnProps,\n      ...userClassesOwnPropsList,\n      userIdOwnProps,\n      ownInlinePropsReg\n    );\n    return new TStyles(mergedOwnProps, parentStyles);\n  }\n}\n"]},"metadata":{},"sourceType":"script"}